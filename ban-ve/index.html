<!DOCTYPE html>
<html>
<head>
  <title>Upload to Google Drive</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    iframe { width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>

<h2>Upload File to Google Drive</h2>

<input type="file" id="fileInput">
<button onclick="upload()">Upload</button>

<p id="status"></p>
<div id="viewer"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbza9m2gVu8QCkF5d0Rcrv17uvmmeqCLCsoMANt_TCvSeAwrR39KtzWBn5jj9bUh7twz/exec";

function upload() {
  const file = document.getElementById("fileInput").files[0];
  const status = document.getElementById("status");
  const viewer = document.getElementById("viewer");

  if (!file) {
    alert("Chọn file trước!");
    return;
  }

  status.innerText = "Đang upload...";

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result.split(',')[1];

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        fileName: file.name,
        mimeType: file.type || "application/octet-stream",
        base64: base64
      }),
      headers: { "Content-Type": "application/json" }
    })
    .then(res => res.json())
    .then(data => {
      if (!data.success) {
        status.innerText = "Lỗi: " + data.error;
        return;
      }

      status.innerHTML = `
        Upload thành công!<br>
        <a href="${data.url}" target="_blank">Mở trên Google Drive</a>
      `;

      // Hiển thị PDF hoặc DWG
      const DRIVE_PREVIEW = `https://drive.google.com/file/d/${data.id}/preview`;

      viewer.innerHTML = `
        <iframe src="${DRIVE_PREVIEW}"></iframe>
      `;
    });
  };

  reader.readAsDataURL(file);
}
</script>

</body>
</html>
