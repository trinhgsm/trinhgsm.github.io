<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Upload to Google Drive</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    iframe { width: 100%; height: 600px; border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>

<h2>Upload file lên Google Drive</h2>

<input type="file" id="fileInput">
<button onclick="upload()">Upload</button>

<p id="status"></p>
<div id="viewer"></div>

<script>
// URL web app Apps Script (kết thúc bằng /exec)
const API_URL = "DÁN_URL_WEB_APP_VÀO_ĐÂY";

function upload() {
  const input = document.getElementById("fileInput");
  const status = document.getElementById("status");
  const viewer = document.getElementById("viewer");

  const file = input.files[0];
  if (!file) {
    alert("Chọn 1 file trước đã.");
    return;
  }

  status.textContent = "Đang upload...";

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result.split(',')[1];

    fetch(https://script.google.com/macros/s/AKfycbza9m2gVu8QCkF5d0Rcrv17uvmmeqCLCsoMANt_TCvSeAwrR39KtzWBn5jj9bUh7twz/exec, {
      method: "POST",
      mode: "cors", // cho rõ ràng
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        fileName: file.name,
        mimeType: file.type || "application/octet-stream",
        base64: base64
      })
    })
    .then(res => res.json())
    .then(data => {
      if (!data.success) {
        status.textContent = "Lỗi: " + data.error;
        return;
      }

      status.innerHTML =
        'Upload xong: <b>' + data.name + '</b><br>' +
        '<a href="' + data.url + '" target="_blank">Mở trên Drive</a>';

      // Xem thử bằng Google Drive preview
      const previewUrl = 'https://drive.google.com/file/d/' + data.id + '/preview';
      viewer.innerHTML = '<iframe src="' + previewUrl + '"></iframe>';
    })
    .catch(err => {
      status.textContent = "Lỗi fetch: " + err;
    });
  };

  reader.readAsDataURL(file);
}
</script>

</body>
</html>
