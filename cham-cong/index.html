<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Dukico Viewer</title>

<style>
body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: #f1f1f1;
}
#loginBox, #mainUI {
    width: 100%;
    max-width: 480px;
    margin: 60px auto;
    background: #fff;
    padding: 28px;
    border-radius: 14px;
    box-shadow: 0px 8px 30px rgba(0,0,0,0.1);
}
h2 {
    margin-top: 0;
}
input, select {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
}
button {
    width: 100%;
    padding: 14px;
    margin-top: 18px;
    border: none;
    background: #333;
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
}
button:hover {
    background: #111;
}

#viewer {
    width: 100%;
    height: calc(100vh - 200px);
    border: none;
    margin-top: 20px;
}

.hidden { display:none; }
</style>
</head>
<body>

<div id="loginBox">
    <h2>Đăng nhập</h2>
    <input id="pass" type="password" placeholder="Nhập mật khẩu…" />
    <button onclick="login()">Mở giao diện</button>
</div>

<div id="mainUI" class="hidden">
    <h2>Dukico Viewer</h2>

    <label>Chọn file:</label>
    <select id="fileSelect" onchange="loadSheets()"></select>

    <label>Chọn sheet:</label>
    <select id="sheetSelect" onchange="loadEmbed()"></select>

    <iframe id="viewer"></iframe>
</div>

<script>
const API =
  "https://script.google.com/macros/s/AKfycbwHS3lImLY7cFJiWE23fZrTN1i8F_hNwfHLwTVLHuh7o1Erwylyj-KwzI7kVhZtlmWm/exec";

let PASSWORD="";

function login() {
    const p = document.getElementById("pass").value.trim();
    PASSWORD = p;

    fetch(API + "?mode=files&pass=" + encodeURIComponent(p))
    .then(r => r.json())
    .then(d => {
        if (d.error === "wrong_password") {
            alert("Sai mật khẩu!");
            return;
        }
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("mainUI").classList.remove("hidden");

        loadFiles(d);
    });
}

function loadFiles(list) {
    const sel = document.getElementById("fileSelect");
    sel.innerHTML = "";

    list.forEach(f => {
        let op = document.createElement("option");
        op.value = f.fileId;
        op.textContent = f.label;
        sel.appendChild(op);
    });

    loadSheets();
}

function loadSheets() {
    const fileId = document.getElementById("fileSelect").value;
    if (!fileId) return;

    fetch(API + "?mode=sheets&fileId=" + fileId + "&pass=" + PASSWORD)
    .then(r => r.json())
    .then(list => {
        const sel = document.getElementById("sheetSelect");
        sel.innerHTML = "";

        list.forEach(sh => {
            let op = document.createElement("option");
            op.value = sh.gid;
            op.textContent = sh.name;
            sel.appendChild(op);
        });

        loadEmbed();
    });
}

function loadEmbed() {
    const fileId = document.getElementById("fileSelect").value;
    const gid = document.getElementById("sheetSelect").value;

    fetch(
      API +
        "?mode=embed&fileId=" +
        fileId +
        "&gid=" +
        gid +
        "&pass=" +
        PASSWORD
    )
      .then(r => r.json())
      .then(d => {
        document.getElementById("viewer").src = d.url;
      });
}
</script>

</body>
</html>
